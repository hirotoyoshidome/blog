<!DOCTYPE html><html lang="ja"> <head><!-- Google Tag Manager --><!-- End Google Tag Manager --><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>2重送信を防ぐ代表的な3パターン</title><meta name="description" content="2重送信を防ぐ代表的な3パターンに関するメモ。"><!-- OGP --><meta property="og:title" content="2重送信を防ぐ代表的な3パターン"><meta name="og:description" content="2重送信を防ぐ代表的な3パターンに関するメモ。"><meta property="og:type" content="website"><!-- Twitter --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="2重送信を防ぐ代表的な3パターン"><meta name="twitter:description" content="2重送信を防ぐ代表的な3パターンに関するメモ。"><link rel="icon" type="image/png" href="/images/favicon.ico"><link rel="stylesheet" href="/_astro/_page_.Cqs_ohrY.css"><script type="module" src="/_astro/hoisted.DBccM9AK.js"></script></head> <body class="prose prose-neutral mx-auto p-6"> <!-- Google Tag Manager (noscript) --> <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TLLX6XR3" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript> <!-- End Google Tag Manager (noscript) -->  <main class="max-w-3xl mx-auto px-6 py-10 text-gray-800 leading-relaxed"> <nav aria-label="Breadcrumb" class="text-sm text-gray-500 mb-6"> <ol class="flex flex-wrap items-center gap-2 list-none"> <li><a href="/" class="text-blue-600 hover:underline">ホーム</a></li> <li aria-hidden="true" class="text-gray-400">/</li> <li><a href="/ja/" class="text-blue-600 hover:underline">記事一覧</a></li> <li aria-hidden="true" class="text-gray-400">/</li> <li class="font-semibold text-gray-700 truncate max-w-[60ch]">2重送信を防ぐ代表的な3パターン</li> </ol> </nav> <header class="mb-8"> <h1 class="text-4xl font-bold tracking-tight mb-2">2重送信を防ぐ代表的な3パターン</h1> <div class="flex flex-wrap items-center gap-3 text-sm text-gray-600"> <time datetime="2018-09-25T00:00:00.000Z"> 2018-09-25 </time> </div> <ul class="flex flex-wrap gap-2 mt-4 list-none"> <li class="text-xs bg-blue-50 text-blue-700 px-2 py-0.5 rounded-full font-medium">
#Security </li><li class="text-xs bg-blue-50 text-blue-700 px-2 py-0.5 rounded-full font-medium">
#CSRF </li><li class="text-xs bg-blue-50 text-blue-700 px-2 py-0.5 rounded-full font-medium">
#Best Practices </li><li class="text-xs bg-blue-50 text-blue-700 px-2 py-0.5 rounded-full font-medium">
#UI/UX </li> </ul> <nav class="text-sm text-gray-600 flex flex-wrap gap-3 mt-4"> <a href="/en/posts/2018/stop-double-send/" class="text-blue-600 hover:underline flex items-center gap-1"> <span aria-hidden="true">⇄</span> English </a> </nav> </header> <ul>
<li>2018/09/25</li>
</ul>
<h2 id="2重送信を防ぐ代表的な3パターン">2重送信を防ぐ代表的な3パターン</h2>
<ul>
<li>PRGパターン<br>
<strong>Post Redirect Get</strong> のことで入力データなどがPostされた際にダブルクリック等で2重送信されてしまった場合データの不整合が生じるためPostした直後に<strong>リダイレクト</strong>してGetで返却する。これにより2重送信を防ぐことができる。</li>
<li>トークン<br>
トークンはデータを送信する際などで**パラメーター値や隠し項目(hidden)**などで、あるキーに対するランダムな値を持たせる。この値は毎回変化するため2重送信がされた場合は値が異なってしまう。これにより2重送信を防止する。(<strong>エラーハンドリング</strong>を行う必要あり)</li>
<li>JavaScriptで送信ボタンを非活性化
JavaScriptはブラウザで動作してくれるため強制的に1回目の送信が行われた際に送信ボタンを<strong>非活性化</strong>することで2重送信を防ぐ方法である。(ブラウザ側でJSを無効にすることが簡単にできてしまうため<strong>単体での使用はダメ</strong>)</li>
</ul>
<h2 id="2重送信による被害">2重送信による被害</h2>
<ul>
<li>DBに重複したデータがinsertされてしまう。</li>
<li>データの不整合</li>
<li>脆弱性となり攻撃される可能性あり<br>
などなど</li>
</ul>
<h2 id="2重送信になってしまうパターン">2重送信になってしまうパターン</h2>
<ul>
<li>送信ボタンのダブルクリック</li>
<li>ブラウザのリロード(F5等での更新)</li>
<li>ブラウザの戻るボタン(alt + ←)で戻ってから再び送信</li>
<li>CSRFによる不正更新リクエストの送信
などなど</li>
</ul>
<h2 id="最後に">最後に</h2>
<p>よく使われているものをピックアップしました。</p> <section class="mt-10 border-t pt-6 space-y-8"> <div class="flex flex-wrap gap-3 items-center"> <span class="text-sm text-gray-600">Share:</span> <a class="text-sm px-3 py-1.5 rounded border hover:bg-gray-50" href="https://twitter.com/intent/tweet?text=2%E9%87%8D%E9%80%81%E4%BF%A1%E3%82%92%E9%98%B2%E3%81%90%E4%BB%A3%E8%A1%A8%E7%9A%84%E3%81%AA3%E3%83%91%E3%82%BF%E3%83%BC%E3%83%B3&url=https%3A%2F%2Fhirotoyoshidome.com%2Fja%2Fposts%2F2018%2Fstop_double_send%2F" rel="noopener">
X (Twitter)
</a> </div> </section> </main>  </body></html>