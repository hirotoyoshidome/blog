<!DOCTYPE html><html lang="en"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Mocks and Stubs with Rails&#39; MiniTest</title><meta name="description" content="How to use MiniTest::Mock and stubs when writing Rails unit tests."><!-- OGP --><meta property="og:title" content="Mocks and Stubs with Rails' MiniTest"><meta name="og:description" content="How to use MiniTest::Mock and stubs when writing Rails unit tests."><meta property="og:type" content="website"><!-- Twitter --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Mocks and Stubs with Rails' MiniTest"><meta name="twitter:description" content="How to use MiniTest::Mock and stubs when writing Rails unit tests."><link rel="icon" type="image/png" href="/blog/images/favicon.ico"><link rel="stylesheet" href="/blog/_astro/_page_.C60xkf-5.css"></head> <body class="prose prose-neutral mx-auto p-6">  <main class="max-w-3xl mx-auto px-6 py-10 text-gray-800 leading-relaxed"> <nav aria-label="Breadcrumb" class="text-sm text-gray-500 mb-6"> <ol class="flex flex-wrap items-center gap-2 list-none"> <li><a href="/blog/" class="text-blue-600 hover:underline">Home</a></li> <li aria-hidden="true" class="text-gray-400">/</li> <li><a href="/blog/en/" class="text-blue-600 hover:underline">Posts</a></li> <li aria-hidden="true" class="text-gray-400">/</li> <li class="font-semibold text-gray-700 truncate max-w-[60ch]">Mocks and Stubs with Rails&#39; MiniTest</li> </ol> </nav> <header class="mb-8"> <h1 class="text-4xl font-bold tracking-tight mb-2">Mocks and Stubs with Rails&#39; MiniTest</h1> <div class="flex flex-wrap items-center gap-3 text-sm text-gray-600"> <time datetime="2018-12-29T00:00:00.000Z"> 2018-12-29 </time> </div> <ul class="flex flex-wrap gap-2 mt-4 list-none"> <li class="text-xs bg-blue-50 text-blue-700 px-2 py-0.5 rounded-full font-medium">
#Rails </li><li class="text-xs bg-blue-50 text-blue-700 px-2 py-0.5 rounded-full font-medium">
#Testing </li><li class="text-xs bg-blue-50 text-blue-700 px-2 py-0.5 rounded-full font-medium">
#TDD </li><li class="text-xs bg-blue-50 text-blue-700 px-2 py-0.5 rounded-full font-medium">
#Ruby </li> </ul> <nav class="text-sm text-gray-600 flex flex-wrap gap-3 mt-4"> <a href="/blog/ja/posts/2018/rails_minitest_mock/" class="text-blue-600 hover:underline flex items-center gap-1"> <span aria-hidden="true">⇄</span> 日本語 </a> </nav> </header> <ul>
<li>2018/12/29</li>
</ul>
<h1 id="using-mocks-and-stubs-in-minitest-for-rails">Using mocks and stubs in MiniTest for Rails</h1>
<p>Hello from the Rails world! I used to write Java and tested with JUnit, but after changing jobs I now use Ruby and PHP. Here is how I use MiniTest—the default unit-testing framework in Rails—to mock and stub things.</p>
<h2 id="what-is-minitest">What is MiniTest?</h2>
<ul>
<li>MiniTest ships with Rails as the standard testing framework.</li>
<li>Compared with the de facto (?) RSpec, it is lighter.</li>
<li>We mainly use it for unit tests.</li>
</ul>
<p>A minimal example looks like this:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>test "test case 001" do</span></span>
<span class="line"><span>  assert_equal 'expected', 'value under test'</span></span>
<span class="line"><span>end</span></span>
<span class="line"><span></span></span></code></pre>
<p>You put the method call or return value under test on the right-hand side. In this example I used <code>assert_equal</code>, which checks equality. Other handy assertions include:</p>





















<table><thead><tr><th align="center">Assertion</th><th align="center">Description</th></tr></thead><tbody><tr><td align="center"><code>assert</code></td><td align="center">Passes when the argument is truthy</td></tr><tr><td align="center"><code>assert_empty</code></td><td align="center">Passes when the argument is empty</td></tr><tr><td align="center"><code>assert_raise</code></td><td align="center">Passes when the specified exception class is raised</td></tr></tbody></table>
<p>That is enough for most basic cases, but explore the docs for more.</p>
<h2 id="what-is-a-mock">What is a mock?</h2>
<ul>
<li>A mock is a stand-in.</li>
<li>You can prevent the original logic from running during a test or swap it out with test-only behavior.</li>
<li>Unit tests focus on one component, so you often replace other classes or external systems with mock objects.</li>
</ul>
<p>Let’s make a simple mock.</p>
<h2 id="using-minitestmock">Using <code>MiniTest::Mock</code></h2>
<p>First require MiniTest at the top of your test file:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>require 'minitest/autorun'</span></span>
<span class="line"><span></span></span></code></pre>
<p>Now you can mock things. Suppose we have a <code>Const</code> class with a constant <code>VAR</code>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>class Const</span></span>
<span class="line"><span>  VAR = 'before'</span></span>
<span class="line"><span>end</span></span>
<span class="line"><span></span></span></code></pre>
<p>You can stub it like this:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>test "test case 002" do</span></span>
<span class="line"><span>  mock = MiniTest::Mock.new</span></span>
<span class="line"><span>  mock.expect :call, "Value we want during the test", []</span></span>
<span class="line"><span>  Const.stub :VAR, mock do</span></span>
<span class="line"><span>    # Inside this block, Const::VAR returns "Value we want during the test".</span></span>
<span class="line"><span>  end</span></span>
<span class="line"><span>end</span></span>
<span class="line"><span></span></span></code></pre>
<p>That helps when you are chasing coverage or isolating unit tests.</p>
<p>You can also provide the replacement value directly without <code>MiniTest::Mock</code>:</p>
<pre class="astro-code github-dark" style="background-color:#24292e;color:#e1e4e8; overflow-x: auto;" tabindex="0" data-language="plaintext"><code><span class="line"><span>test "test case 003" do</span></span>
<span class="line"><span>  Const.stub :VAR, "Value we want during the test" do</span></span>
<span class="line"><span>    # Within this block, Const::VAR is set to the provided value.</span></span>
<span class="line"><span>  end</span></span>
<span class="line"><span>end</span></span>
<span class="line"><span></span></span></code></pre>
<p>Check the official docs for more details.</p> <section class="mt-10 border-t pt-6 space-y-8"> <div class="flex flex-wrap gap-3 items-center"> <span class="text-sm text-gray-600">Share:</span> <a class="text-sm px-3 py-1.5 rounded border hover:bg-gray-50" href="https://twitter.com/intent/tweet?text=Mocks%20and%20Stubs%20with%20Rails'%20MiniTest&url=https%3A%2F%2Fhirotoyoshidome.github.io%2Fblog%2Fen%2Fposts%2F2018%2Frails-minitest-mock%2F" rel="noopener">
X (Twitter)
</a> </div> </section> </main>  </body></html>