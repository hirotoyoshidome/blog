<!DOCTYPE html><html lang="en"> <head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Why Directly Storing Uploads in the Database Is Risky</title><meta name="description" content="Notes on the risks and countermeasures when handling file uploads."><!-- OGP --><meta property="og:title" content="Why Directly Storing Uploads in the Database Is Risky"><meta name="og:description" content="Notes on the risks and countermeasures when handling file uploads."><meta property="og:type" content="website"><!-- Twitter --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:title" content="Why Directly Storing Uploads in the Database Is Risky"><meta name="twitter:description" content="Notes on the risks and countermeasures when handling file uploads."><link rel="icon" type="image/png" href="/images/favicon.ico"><link rel="stylesheet" href="/_astro/_page_.C60xkf-5.css"></head> <body class="prose prose-neutral mx-auto p-6">  <main class="max-w-3xl mx-auto px-6 py-10 text-gray-800 leading-relaxed"> <nav aria-label="Breadcrumb" class="text-sm text-gray-500 mb-6"> <ol class="flex flex-wrap items-center gap-2 list-none"> <li><a href="/" class="text-blue-600 hover:underline">Home</a></li> <li aria-hidden="true" class="text-gray-400">/</li> <li><a href="/en/" class="text-blue-600 hover:underline">Posts</a></li> <li aria-hidden="true" class="text-gray-400">/</li> <li class="font-semibold text-gray-700 truncate max-w-[60ch]">Why Directly Storing Uploads in the Database Is Risky</li> </ol> </nav> <header class="mb-8"> <h1 class="text-4xl font-bold tracking-tight mb-2">Why Directly Storing Uploads in the Database Is Risky</h1> <div class="flex flex-wrap items-center gap-3 text-sm text-gray-600"> <time datetime="2018-08-30T00:00:00.000Z"> 2018-08-30 </time> </div> <ul class="flex flex-wrap gap-2 mt-4 list-none"> <li class="text-xs bg-blue-50 text-blue-700 px-2 py-0.5 rounded-full font-medium">
#Security </li><li class="text-xs bg-blue-50 text-blue-700 px-2 py-0.5 rounded-full font-medium">
#Best Practices </li><li class="text-xs bg-blue-50 text-blue-700 px-2 py-0.5 rounded-full font-medium">
#Software Architecture </li> </ul> <nav class="text-sm text-gray-600 flex flex-wrap gap-3 mt-4"> <a href="/ja/posts/2018/handling_file_upload/" class="text-blue-600 hover:underline flex items-center gap-1"> <span aria-hidden="true">⇄</span> 日本語 </a> </nav> </header> <ul>
<li>2018/08/30</li>
</ul>
<h2 id="why-saving-uploads-as-is-in-the-database-is-dangerous">Why saving uploads as-is in the database is dangerous</h2>
<ul>
<li>A malicious file could be uploaded and compromise the entire database.</li>
<li>If malware is embedded, the whole system can be taken over.</li>
<li>Accepting extensions you do not anticipate increases the chance of someone uploading a virus.</li>
<li>Attackers can intentionally upload very large files and trigger server-side latency.</li>
</ul>
<h2 id="behavior-at-upload-time">Behavior at upload time</h2>
<ul>
<li>Validate file extensions on the client with JavaScript before the upload (but never rely on it—users can disable JS, so always validate on the server as well).</li>
<li>Configure a temporary storage location so the OS can run a virus scan before you persist the file for good.</li>
<li>If malware is found, discard the file immediately.</li>
</ul>
<h2 id="in-closing">In closing</h2>
<ul>
<li>Extensions are easy to fake, so stay vigilant!</li>
</ul> <section class="mt-10 border-t pt-6 space-y-8"> <div class="flex flex-wrap gap-3 items-center"> <span class="text-sm text-gray-600">Share:</span> <a class="text-sm px-3 py-1.5 rounded border hover:bg-gray-50" href="https://twitter.com/intent/tweet?text=Why%20Directly%20Storing%20Uploads%20in%20the%20Database%20Is%20Risky&url=https%3A%2F%2Fhirotoyoshidome.com%2Fen%2Fposts%2F2018%2Fhandling-file-upload%2F" rel="noopener">
X (Twitter)
</a> </div> </section> </main>  </body></html>